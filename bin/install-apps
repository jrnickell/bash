# !/bin/bash --login -x

echo -n "==> Choose a password for MySQL and phpMyAdmin: "
read PASSWORD

echo -n "==> Enter your full name for Git configuration: "
read FULLNAME

echo -n "==> Enter your email address for Git configuration: "
read EMAILADD

# home directory
cd ~

# repositories; hit [Enter] for each one to continue
sudo add-apt-repository ppa:webupd8team/sublime-text-2

# update packages
sudo apt-get update

# debconf utils
sudo apt-get install -y debconf-utils

# parameters
echo "mysql-server mysql-server/root_password password $PASSWORD" | sudo debconf-set-selections
echo "mysql-server mysql-server/root_password_again password $PASSWORD" | sudo debconf-set-selections
echo "phpmyadmin phpmyadmin/dbconfig-install boolean true" | sudo debconf-set-selections
echo "phpmyadmin phpmyadmin/mysql/admin-pass password $PASSWORD" | sudo debconf-set-selections
echo "phpmyadmin phpmyadmin/mysql/app-pass password $PASSWORD" | sudo debconf-set-selections
echo "phpmyadmin phpmyadmin/app-password-confirm password $PASSWORD" | sudo debconf-set-selections
echo "phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2" | sudo debconf-set-selections

# general utilities
sudo apt-get install -y aptitude
sudo apt-get install -y wget
sudo apt-get install -y curl
sudo apt-get install -y git
sudo apt-get install -y vim
sudo apt-get install -y cron
sudo apt-get install -y build-essential
sudo apt-get install -y openssl
sudo apt-get install -y subversion
sudo apt-get install -y python-software-properties
sudo apt-get install -y python
sudo apt-get install -y gcc
sudo apt-get install -y g++
sudo apt-get install -y make
sudo apt-get install -y re2c
sudo apt-get install -y keychain

# git general config
git config --global user.name "$FULLNAME"
git config --global user.email "$EMAILADD"
git config --global color.ui true
git config --global push.default simple

# sublime text
sudo apt-get install -y sublime-text

# chromium
sudo apt-get install -y chromium-browser

# filezilla
sudo apt-get install -y filezilla

# fonts
sudo apt-get install -y fonts-beteckna
sudo apt-get install -y fonts-breip
sudo apt-get install -y fonts-cabin
sudo apt-get install -y fonts-cabinsketch
sudo apt-get install -y fonts-cantarell
sudo apt-get install -y fonts-comfortaa
sudo apt-get install -y fonts-dancingscript
sudo apt-get install -y fonts-deva-extra
sudo apt-get install -y fonts-dkg-handwriting
sudo apt-get install -y fonts-dosis
sudo apt-get install -y fonts-droid
sudo apt-get install -y fonts-dustin
sudo apt-get install -y fonts-ecolier-court
sudo apt-get install -y fonts-fanwood
sudo apt-get install -y fonts-freefont-ttf
sudo apt-get install -y fonts-inconsolata
sudo apt-get install -y fonts-jura
sudo apt-get install -y fonts-konatu
sudo apt-get install -y fonts-larabie-deco
sudo apt-get install -y fonts-larabie-straight
sudo apt-get install -y fonts-larabie-uncommon
sudo apt-get install -y fonts-lato
sudo apt-get install -y fonts-liberation
sudo apt-get install -y fonts-lindenhill
sudo apt-get install -y fonts-linuxlibertine
sudo apt-get install -y fonts-lobster
sudo apt-get install -y fonts-lobstertwo
sudo apt-get install -y fonts-quattrocento
sudo apt-get install -y fonts-tomsontalks
sudo apt-get install -y fonts-ubuntu-font-family-console
sudo apt-get install -y fonts-ubuntu-title

# apache
sudo apt-get install -y apache2

# Update apache2.conf with backup
sudo cp /etc/apache2/apache2.conf /etc/apache2/apache2.conf.bak
cat /etc/apache2/apache2.conf.bak | sed '
/^# Global/ a\
ServerName localhost
' | sudo tee /etc/apache2/apache2.conf

# apache modules
sudo a2enmod rewrite
sudo a2enmod headers
sudo a2enmod filter
sudo a2enmod expires
sudo a2enmod include

# php
sudo apt-get install -y php5
sudo apt-get install -y libapache2-mod-php5
sudo apt-get install -y php5-dev

# mysql
sudo apt-get install -y -q mysql-server
sudo apt-get install -y php5-mysql

# sqlite
sudo apt-get install -y sqlite3

# phpmyadmin
sudo apt-get install -y -q phpmyadmin

# php extensions
sudo apt-get install -y php-apc
sudo apt-get install -y php5-curl
sudo apt-get install -y php5-intl
sudo apt-get install -y php5-xdebug
sudo apt-get install -y php5-xmlrpc
sudo apt-get install -y php5-xsl
sudo apt-get install -y php5-sqlite
sudo apt-get install -y php5-imagick
sudo apt-get install -y php5-json
sudo apt-get install -y php5-apcu
sudo apt-get install -y php5-mcrypt

# composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer

# mcrypt installation fix
sudo cp /etc/php5/conf.d/mcrypt.ini /etc/php5/mods-available/
sudo php5enmod mcrypt

# zephir
sudo apt-get install -y libpcre3-dev
cd ~/.local
# temporarily broken
# git clone https://github.com/json-c/json-c.git
git clone https://github.com/fingon/json-c # TEMP
cd json-c
git branch unused_size # TEMP
git checkout unused_size # TEMP
git pull -u origin unused_size # TEMP
sh autogen.sh
./configure
make && sudo make install
cd ~/.local
git clone https://github.com/phalcon/zephir
cd zephir
./install -c
cd ~

# restart apache
sudo service apache2 restart

# ruby install
# following this guide:
# http://ryanbigg.com/2010/12/ubuntu-ruby-rvm-rails-and-you/
curl -L get.rvm.io | bash -s stable

# source rvm script and add to .bashrc
source ~/.rvm/scripts/rvm
echo 'source ~/.rvm/scripts/rvm' | tee -a ~/.bashrc

# install requirements
rvm requirements

# ruby
rvm install 2.1.1
rvm use 2.1.1
rvm --default use 2.1.1

# compass sass
gem update --system
gem install compass

# nodejs
# now manually downloading and compiling from source
# following this guide:
# http://tnovelli.net/blog/blog.2011-08-27.node-npm-user-install.html
touch ~/.npmrc
mkdir ~/.local
echo "root = /home/$USER/.local/lib/node_modules" | tee -a ~/.npmrc
echo "binroot = /home/$USER/.local/bin" | tee -a ~/.npmrc
echo "manroot = /home/$USER/.local/share/man" | tee -a ~/.npmrc
cd ~/.local
wget "http://nodejs.org/dist/v0.10.26/node-v0.10.26.tar.gz"
tar xf node-v0.10.26.tar.gz
rm node-v0.10.26.tar.gz
mv node-v0.10.26 node
cd node
./configure --prefix=~/.local
make
make install
cd ~
ln -s .local/lib/node_modules .node_modules
# update PATH in .bashrc
echo 'PATH=$PATH:$HOME/.local/bin' | tee -a ~/.bashrc
# update PATH right away
export PATH=$PATH:$HOME/.local/bin

# java
sudo apt-get install -y openjdk-7-jre
sudo apt-get install -y openjdk-7-jdk

# cleanup
sudo apt-get autoremove -y
sudo apt-get update
sudo apt-get upgrade -y

# Version information
echo -e "\nInstallation Complete!"
echo -e "======================"

echo -e "\nPython Version:"
echo -e "==============="
python -V

echo -e "\nJava Version:"
echo -e "============="
java -version

echo -e "\nRuby Version:"
echo -e "============="
ruby --version

echo -e "\nSass Version:"
echo -e "============="
sass --version

echo -e "\nCompass Version:"
echo -e "================"
compass version

echo -e "\nNode Version:"
echo -e "============="
node --version

echo -e "\nApache Version:"
echo -e "==============="
apache2 -v

echo -e "\nMySQL Version:"
echo -e "=============="
mysql -V

echo -e "\nPHP Version:"
echo -e "============"
php -v

echo -e "\nGit Version:"
echo -e "============"
git --version
